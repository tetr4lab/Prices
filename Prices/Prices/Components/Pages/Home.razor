@using System.ComponentModel;

@inherits PricesComponentBase
@implements IDisposable

@page "/"

@inject IAuthorizationService AuthorizationService
@inject PricesDataSet DataSet

<PageTitle>Prices</PageTitle>

@switch (AppModeService.CurrentMode) {
    case AppMode.Boot:
        if (!UiState.IsLocked) {
            UiState.Lock ("Loading...");
        }
        break;
    case AppMode.Prices:
        <PriceList />
        break;
    case AppMode.Products:
        <ProductList />
        break;
    case AppMode.Categories:
        <CategoryList />
        break;
    case AppMode.Stores:
        <StoreList />
        break;
    default:
        break;
}

@code {
    /// <inheritdoc/>
    protected override async Task OnAfterRenderAsync (bool firstRender) {
        await base.OnAfterRenderAsync (firstRender);
        if (firstRender && !DataSet.IsInitialized && !DataSet.IsInitializeStarted) {
            try {
                // DB初期化
                await DataSet.InitializeAsync ();
                await TaskEx.DelayUntil (() => DataSet.IsReady);
                AppModeService.SetMode (AppMode.Prices);
            }
            catch (Exception ex) {
                System.Diagnostics.Debug.WriteLine (ex);
            }
        }
    }
}
